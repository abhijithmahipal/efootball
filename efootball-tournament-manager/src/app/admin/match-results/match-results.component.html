<div class="match-results-container">
  <div class="header">
    <h2>Match Results</h2>
    <p class="subtitle">Enter and manage match scores</p>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading$ | async" class="loading-container">
    <div class="loading-spinner"></div>
    <p>Loading matches...</p>
  </div>

  <!-- Main Content -->
  <div *ngIf="!(isLoading$ | async)" class="content">
    <!-- Filters -->
    <div class="filters-section">
      <h3>Filter Matches</h3>
      <form [formGroup]="filterForm" class="filters-form">
        <div class="filter-group">
          <label for="matchType">Match Type:</label>
          <select
            id="matchType"
            formControlName="matchType"
            class="form-control"
          >
            <option value="all">All Matches</option>
            <option value="league">League Matches</option>
            <option value="playoff">Playoff Matches</option>
          </select>
        </div>

        <div class="filter-group">
          <label for="matchStatus">Status:</label>
          <select
            id="matchStatus"
            formControlName="matchStatus"
            class="form-control"
          >
            <option value="all">All Statuses</option>
            <option value="pending">Pending</option>
            <option value="completed">Completed</option>
          </select>
        </div>

        <div class="filter-group">
          <label for="matchday">Matchday:</label>
          <select id="matchday" formControlName="matchday" class="form-control">
            <option value="all">All Matchdays</option>
            <option
              *ngFor="let matchday of getMatchdays() | async"
              [value]="matchday"
            >
              Matchday {{ matchday }}
            </option>
          </select>
        </div>
      </form>
    </div>

    <!-- Matches List -->
    <div class="matches-section">
      <h3>Matches</h3>

      <!-- No matches message -->
      <div *ngIf="(filteredMatches$ | async)?.length === 0" class="no-matches">
        <p>No matches found with the current filters.</p>
      </div>

      <!-- Matches table -->
      <div
        *ngIf="(filteredMatches$ | async)?.length! > 0"
        class="matches-table-container"
      >
        <table class="matches-table">
          <thead>
            <tr>
              <th>Matchday</th>
              <th>Type</th>
              <th>Home Player</th>
              <th>Result</th>
              <th>Away Player</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr
              *ngFor="
                let match of filteredMatches$ | async;
                trackBy: trackByMatchId
              "
              [class.selected-match]="selectedMatch?.id === match.id"
            >
              <td>{{ match.matchday }}</td>
              <td>
                <span
                  class="match-type-badge"
                  [class]="match.isPlayoff ? 'playoff-badge' : 'league-badge'"
                >
                  {{ getMatchTypeText(match) }}
                </span>
              </td>
              <td class="player-name">{{ match.homePlayerName }}</td>
              <td class="match-result">{{ getMatchResultText(match) }}</td>
              <td class="player-name">{{ match.awayPlayerName }}</td>
              <td>
                <span class="status-badge" [class]="getMatchStatusClass(match)">
                  {{ getMatchStatusText(match) }}
                </span>
              </td>
              <td>
                <button
                  type="button"
                  class="btn btn-primary btn-sm"
                  (click)="selectMatch(match)"
                  [disabled]="isSubmitting"
                >
                  {{ match.isPlayed ? "Edit Result" : "Enter Result" }}
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Result Entry Form -->
    <div *ngIf="selectedMatch" class="result-form-section">
      <h3>{{ selectedMatch.isPlayed ? "Edit" : "Enter" }} Match Result</h3>

      <div class="selected-match-info">
        <h4>
          {{ selectedMatch.homePlayerName }} vs
          {{ selectedMatch.awayPlayerName }}
        </h4>
        <p>
          <span class="match-details">
            Matchday {{ selectedMatch.matchday }} â€¢
            {{ getMatchTypeText(selectedMatch) }}
          </span>
        </p>
      </div>

      <form
        [formGroup]="resultForm"
        (ngSubmit)="onSubmitResult()"
        class="result-form"
      >
        <div class="score-inputs">
          <div class="score-group">
            <label for="homeGoals"
              >{{ selectedMatch.homePlayerName }} Goals:</label
            >
            <input
              type="number"
              id="homeGoals"
              formControlName="homeGoals"
              class="form-control score-input"
              min="0"
              step="1"
              [class.error]="getFieldError('homeGoals')"
              placeholder="0"
            />
            <div *ngIf="getFieldError('homeGoals')" class="error-message">
              {{ getFieldError("homeGoals") }}
            </div>
          </div>

          <div class="vs-separator">VS</div>

          <div class="score-group">
            <label for="awayGoals"
              >{{ selectedMatch.awayPlayerName }} Goals:</label
            >
            <input
              type="number"
              id="awayGoals"
              formControlName="awayGoals"
              class="form-control score-input"
              min="0"
              step="1"
              [class.error]="getFieldError('awayGoals')"
              placeholder="0"
            />
            <div *ngIf="getFieldError('awayGoals')" class="error-message">
              {{ getFieldError("awayGoals") }}
            </div>
          </div>
        </div>

        <div class="form-actions">
          <button
            type="submit"
            class="btn btn-success"
            [disabled]="!canSubmit()"
          >
            <span *ngIf="isSubmitting" class="loading-spinner-small"></span>
            {{
              isSubmitting
                ? "Saving..."
                : selectedMatch.isPlayed
                ? "Update Result"
                : "Save Result"
            }}
          </button>

          <button
            type="button"
            class="btn btn-secondary"
            (click)="clearSelection()"
            [disabled]="isSubmitting"
          >
            Cancel
          </button>
        </div>
      </form>
    </div>

    <!-- Messages -->
    <div *ngIf="successMessage" class="alert alert-success">
      {{ successMessage }}
    </div>

    <div *ngIf="errorMessage" class="alert alert-error">
      {{ errorMessage }}
    </div>

    <!-- Current Standings Preview -->
    <div class="standings-preview">
      <h3>Current Standings</h3>
      <div *ngIf="(standings$ | async)?.length === 0" class="no-standings">
        <p>
          No standings available yet. Enter some match results to see the points
          table.
        </p>
      </div>

      <div
        *ngIf="(standings$ | async)?.length! > 0"
        class="standings-table-container"
      >
        <table class="standings-table">
          <thead>
            <tr>
              <th>Pos</th>
              <th>Player</th>
              <th>MP</th>
              <th>W</th>
              <th>D</th>
              <th>L</th>
              <th>GF</th>
              <th>GA</th>
              <th>GD</th>
              <th>Pts</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let standing of standings$ | async; let i = index">
              <td class="position">{{ i + 1 }}</td>
              <td class="player-name">{{ standing.playerName }}</td>
              <td>{{ standing.matchesPlayed }}</td>
              <td>{{ standing.wins }}</td>
              <td>{{ standing.draws }}</td>
              <td>{{ standing.losses }}</td>
              <td>{{ standing.goalsFor }}</td>
              <td>{{ standing.goalsAgainst }}</td>
              <td
                [class]="standing.goalDifference >= 0 ? 'positive' : 'negative'"
              >
                {{ standing.goalDifference >= 0 ? "+" : ""
                }}{{ standing.goalDifference }}
              </td>
              <td class="points">{{ standing.points }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
